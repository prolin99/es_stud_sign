<{$bootstrap}>
<{$jquery}>
<{$toolbar}>
<script language='javascript' type='text/javascript' src='<{$xoops_url}>/modules/tadtools/My97DatePicker/WdatePicker.js'></script>

<{if   $data.kind_in }>
<!--     輸入                          -->
<{foreach  key=key item=sign   from=$data.kind_in  }>
 
<!-- <{$i++}> -->
   <h4> 班級：<{$data.sel_class }></h4>
    <form  action="index.php" method="post">
    <fieldset>
    <h3><{ $sign.title }> </h3>
    <h4><{ $sign.doc }> </h4>
    <!--  尚無輸入資料  -->
    
    <label>快速輸入區</label>
    <input type="text" class="span5"  id="q_input"  placeholder="輸入學生座號，多人時以逗號或空白分隔">
    
    <!--    輸入欄         --------------------------------- -->
    <h5>正取資料輸入</h5>
	<{section name=ti  start=0  loop=$sign.stud_get   step=1  }>
	
    	<div  class="row-fluid">
 	
        <span class="span2"><span class="badge badge-info"><{$i}></span>
        <input class="span9 sitid" id="sitid_<{$i}>" name="num_id[<{$i}>]"   value="<{$data.my_class[$data.sel_class][$i].stud_name }>" type="text"   title="座號才能擷取出資料" placeholder="座號或姓名" data="<{$sign.get_data_item}>"></span>
        <!--     需輸入欄         -->
        <{foreach  key=key item=fi   from=$sign.field_input  }>
        <{ if ($fi[2]=='d') }>
        	<span class="span<{$fi[3]}>">
        	<input class="span12 self_input" name="in_<{$fi[0]}>[<{$i}>]" type="text"  title="<{$fi[1]}>" placeholder="<{$fi[1]}>"  
        	<{if $data.my_class[$data.sel_class][$i].stud_name }>
        	<{assign var="bar" value="in_$fi[0]"}>
        	value="<{$data.my_class[$data.sel_class][$i][$bar] }>"
        	<{else}>
        	value="<{$fi[4]}>"
        	<{/if}>
        	onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" mode="<{$fi[2]}>">
        	</span>        
        <{else}>
        	<span class="span<{$fi[3]}>">
        	<input class="span12 self_input" name="in_<{$fi[0]}>[<{$i}>]" type="text"  title="<{$fi[1]}>" placeholder="<{$fi[1]}>"  
        	<{if $data.my_class[$data.sel_class][$i].stud_name }>
        	<{assign var="bar" value="in_$fi[0]"}>
        	value="<{$data.my_class[$data.sel_class][$i][$bar] }>"
        	<{else}>
        	value="<{$fi[4]}>"
        	<{/if}>
        	mode="<{$fi[2]}>">
        	</span>
        <{/if}>	
        <{/foreach}>
        <!--     擷取欄         -->
 	<span class="span4"  id="get_<{$i}>">
 	<{$data.my_class[$data.sel_class][$i].get_hide }>
        </span>

	</div>
	<!-- <{$i++}> -->
 	<{ /section }>
 	
    <!--    備取區         ------------------------------------------------------- -->
    <{ if ($sign.stud_get_more) }>
    <h5>備取資料輸入</h5>
	<{section name=ti  start=0  loop=$sign.stud_get_more   step=1  }>
	
    	<div  class="row-fluid">
 	
        <span class="span2"><span class="badge badge-info"><{$i}></span>
        <input class="span9 sitid" id="sitid_<{$i}>" name="num_id[<{$i}>]"   value="<{$data.my_class[$data.sel_class][$i].stud_name }>" type="text"   title="座號才能擷取出資料" placeholder="座號或姓名" data="<{$sign.get_data_item}>"></span>
        <!--     需輸入欄         -->
        <{foreach  key=key item=fi   from=$sign.field_input  }>
        <{ if ($fi[2]=='d') }>
        	<span class="span<{$fi[3]}>">
        	<input class="span12 self_input" name="in_<{$fi[0]}>[<{$i}>]" type="text"  title="<{$fi[1]}>" placeholder="<{$fi[1]}>"  
        	<{if $data.my_class[$data.sel_class][$i].stud_name }>
        	<{assign var="bar" value="in_$fi[0]"}>
        	value="<{$data.my_class[$data.sel_class][$i][$bar] }>"
        	<{else}>
        	value="<{$fi[4]}>"
        	<{/if}>
        	onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" mode="<{$fi[2]}>">
        	</span>        
        <{else}>
        	<span class="span<{$fi[3]}>">
        	<input class="span12 self_input" name="in_<{$fi[0]}>[<{$i}>]" type="text"  title="<{$fi[1]}>" placeholder="<{$fi[1]}>"  
        	<{if $data.my_class[$data.sel_class][$i].stud_name }>
        	<{assign var="bar" value="in_$fi[0]"}>
        	value="<{$data.my_class[$data.sel_class][$i][$bar] }>"
        	<{else}>
        	value="<{$fi[4]}>"
        	<{/if}>
        	mode="<{$fi[2]}>">
        	</span>
        <{/if}>	
        <{/foreach}>
        <!--     擷取欄         -->
 	<span class="span4"  id="get_<{$i}>">
 	<{$data.my_class[$data.sel_class][$i].get_hide }>
        </span>
 
	</div>
	<!-- <{$i++}> -->
 	<{ /section }>    
    <{/if}>	
    <input type='hidden' name='now_class'   value='<{$data.sel_class }>'  >
    <input type='hidden' name='now_kind'   value='<{ $sign.id }>'  >
    <input type='hidden' name='input_data_item'   value='<{ $sign.input_data_item }>'  >
    <button type="submit" class="btn btn-success" name='ADD' value='add' >報名完成</button>
    <button type="submit" class="btn btn-danger" name='Submit_emp' value='empt'  title="如果班上沒有學生符合或要參加，按下這鍵代表貴班已填報過了的記號。"  >班上沒有學生要報名</button>
    </fieldset>
    </form>
 
<{/foreach}>

<script>
function IsNumeric(num) {
     return (num >=0 || num < 0);
}

//由座號，擷取資料
$(function() {
	$(".sitid").change(function(){
		var tid = $( this ).attr('id') ;
		var sit_id = $( this ).val();
		var get_f = $( this ).attr('data') ;
 		getdata( <{$data.sel_class }> ,tid , sit_id ,get_f) ;
	});
});
 
 function getdata(class_id ,tid , sit_id ,get_f)  {
 	//alert(class_id + tid +sit_id +get_f) ;
 	if ( !  IsNumeric(sit_id) ) return ;
 	var splits = tid.split('_') ;
 	var iid= splits[1] ;
 	$.ajax({
 		url: 'ajax_get_stud_data.php',
 		type: 'GET',
 		dateType:'json', //接收資料格式
 		data: {class_id: class_id , class_sit_id:sit_id , tid:tid , fi:get_f },
 	})
 	.done(function(data) {
 		//console.log("success");
 		//取得 json 格式
 		var json_obj = jQuery.parseJSON(data) ;
 		//alert( iid + json_obj.name) ;
 		//更改姓名、擷取資料
		$("#sitid_" + iid).val( json_obj.name) ;
 		$("#get_" + iid).html( json_obj.html ) ;
 		//alert(data) ;
 	})
 	.fail(function() {
 		console.log("error");
 	})
 	.always(function() {
 		console.log("complete");
 	});
 
 	
 }






</script>



<{else}>
<!--     列出總表                            -->
<{$i++}>
<{foreach  key=key item=sign   from=$data.kind  }>
<{if ($sign.cando) }>
<div class="row-fluid  alert-success" >
<span class="span1">
 
<a class="btn btn-success" href="index.php?id=<{$sign.id}>" >報名</a>
</span>
<{ else }>
<div class="row-fluid  alert-error" >
<span class="span1">
過期
</span>
<{/if}>

<span class="span5"><div class="alert alert-info"><span class="badge badge-info"><{$i++}></span><{$sign.title}></div><{$sign.doc}><br /></span>
<span class="span1"><{$sign.admin}></span>
<span class="label label-info">還有 <{$sign.d_days}> 天</span>
</div>
<{/foreach}>


<{/if}>
